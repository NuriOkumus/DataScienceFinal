import dynamic from 'next/dynamic'

{/* Dynamic import is needed for client-side only components in Next.js */}
export const WebRConsole = dynamic(() => import('../components/WebRConsole'), { ssr: false })

# 01. Eksik Veri (Missing Data) ve MICE

## 1. Neden Veri Eksik? (Missing Data Mechanisms)

Veri setindeki boşlukların (NA) sebebi, `mice` paketinin başarısını doğrudan etkiler. 3 ana kategori vardır:

### A. MCAR (Missing Completely at Random)
*   **Türkçesi:** Tamamen Rastgele Kayıp.
*   **Mantık:** Verinin eksik olması şans eseridir. Ne eksik değerin kendisiyle ne de diğer değişkenlerle bir ilişkisi vardır.
*   **Örnek:** Laboratuvarda bir tüpün yanlışlıkla kırılması.
*   **Çözüm:** En zararsız türdür. Satırı silseniz (`na.omit`) bile analiz bozulmaz (veri kaybı dışında).

### B. MAR (Missing at Random)
*   **Türkçesi:** Rastgele Kayıp (Ama Gözlemlenebilen Bir Değişkene Bağlı).
*   **Mantık:** Eksiklik, veri setindeki *başka bir değişkene* bağlıdır.
*   **Örnek:** Kadınların yaşlarını söyleme eğilimi erkeklere göre daha düşük olabilir. Burada "Yaş" verisinin eksikliği, "Cinsiyet" değişkenine bağlıdır.
*   **Önemi:** `mice` paketi ve modern yöntemler (PMM) varsayılan olarak **bu durumu varsayar**.
*   **Çözüm:** Diğer değişkenleri kullanarak eksik veriyi tahmin etmek (Imputation) çok başarılı sonuç verir.

### C. MNAR (Missing Not at Random)
*   **Türkçesi:** Rastgele Olmayan Kayıp.
*   **Mantık:** Eksiklik, **eksik olan değerin kendisine** bağlıdır. En tehlikeli durumdur.
*   **Örnek:** Çok kilolu insanlar, tartılmak istemedikleri için kilo verisi eksiktir. Kilo verisi eksik çünkü kilonun kendisi yüksek.
*   **Sorun:** `mice` bu durumu doğrudan düzeltemez çünkü verinin neden eksik olduğunu "göremez".

<WebRConsole initialCode={`# 1. Hazırlık ve Eksik Veri Yaratma (Senaryo)
library(MASS)
library(mice)
data(Pima.tr)

# Eğitim amaçlı rastgele NA (kayıp) değerler oluşturalım
set.seed(123)
Pima_miss <- Pima.tr
# BMI değişkeninde 20 rastgele kişiyi "bilinmiyor" (NA) yap
Pima_miss[sample(1:nrow(Pima_miss), 20), "bmi"] <- NA 

# Eksik verinin yapısını gör (Pattern)
md.pattern(Pima_miss)
`} />

---

## 2. MICE ve PMM (Predictive Mean Matching)

`mice` paketi (Multivariate Imputation by Chained Equations), eksik verileri doldurmak için en popüler araçtır. Varsayılan yöntemi **PMM**'dir.

### PMM Nasıl Çalışır? (Basit Mantık)
PMM, eksik veriyi doldurmak için **gerçek** bir değer kopyalar. Matematiksel bir ortalama yazmaz.

1.  **Regresyon Modeli Kur:** Eksik değişkeni (örn: BMI), diğer değişkenleri (Yaş, Şeker) kullanarak tahmin edecek bir model kurar.
2.  **Tahmin Et:** Eksik olan satır için bir BMI değeri tahmin eder (örn: 28.4).
3.  **Benzerini Bul (Donor):** Veri setinde BMI değeri **dolu** olan kişiler arasında, tahmini 28.4'e en yakın olan kişiyi bulur.
4.  **Kopyala:** O benzer kişinin (donörün) **gerçek** BMI değerini (örn: 28.1) alıp eksik yere yazar.

### Neden PMM Harika?
*   **Gerçekçi Değerler:** Asla 2.5 çocuk veya -5 tansiyon gibi imkansız sayılar üretmez. Çünkü veri setinden gerçek bir sayı kopyalar.
*   **Dağılımı Korur:** Verinin orijinal şeklini (varyansını) bozmaz.

<WebRConsole initialCode={`# 2. MICE ile Doldurma (Imputation)
# m=5 : 5 farklı doldurulmuş veri seti oluştur.
# method='pmm' : Predictive Mean Matching
# maxit=5 : 5 iterasyon (Hız için düşük tuttuk)

imputed_data <- mice(Pima_miss, m = 5, method = 'pmm', maxit = 5, seed = 500)

# Özeti görelim
summary(imputed_data)

# İlk doldurulmuş seti çekelim ve kontrol edelim
completed_data_1 <- complete(imputed_data, action = 1)
sum(is.na(completed_data_1)) # 0 olmalı (yani hiç NA kalmamalı)
`} />

---

### Sınav İpucu: mice(m=5) Parametresi
*   **m=5 ne demek?** `mice` fonksiyonu veriyi 5 kere farklı şekillerde doldurur ve 5 farklı veri seti oluşturur.
*   **Neden?** Tek bir doldurma işlemi hataya açık olabilir. 5 farklı tahmin yaparak belirsizliği (uncertainty) modele katmış oluruz.
*   **Sonuç:** `pool()` fonksiyonu bu 5 farklı havuzun sonuçlarını birleştirir.

<WebRConsole initialCode={`# 3. Modelleme ve Pooling (Analiz Kısmı)
# Soru: "BMI değerini, yaş ve şeker ile tahmin edebilir miyiz?"
# NOT: 'with' fonksiyonu her 5 veri seti için ayrı ayrı model kurar.

fit_mice <- with(data = imputed_data, exp = lm(bmi ~ age + glu + npreg))

# 'pool' fonksiyonu sonuçları birleştirir (Ortalamasını alır)
pooled_results <- pool(fit_mice)

summary(pooled_results)
`} />
